<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - CineVerse</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="shortcut icon" href="./logo1.png" type="image/x-icon">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="logo" id="logo">
            <a href="./index.html">
                <img src="./logo1.png" alt="Movies Logo">
            </a>
        </div>
        <div>
            <h1 style="color: #ffA500;"><b><i>CineVerse</i></b></h1>
        </div>
        <nav class="nav-links">
            <a href="./genre.html"><b>Genre</b></a>
            <a href="./search.html"><b>Search</b></a>
        </nav>
    </header>

    <main>
        <div id="movie-details" class="movie-details">
            <!-- Movie details and video will be inserted here -->
        </div>
    </main>

    <script>
        const apiKey = '06441985e67b0834a714e7433b1250ca';
        const baseUrl = 'https://api.themoviedb.org/3';
        const movieDetails = document.getElementById('movie-details');

        // Function to get the movie ID from the URL
        function getMovieId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('movieId');
        }

        // Fetch movie details
        async function fetchMovieDetails(movieId) {
            try {
                const response = await fetch(`${baseUrl}/movie/${movieId}?api_key=${apiKey}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch movie details');
                }
                const movie = await response.json();
                displayMovieDetails(movie);
                fetchMovieVideos(movieId); // Fetch movie video data after loading details
            } catch (error) {
                console.error('Error fetching movie details:', error);
            }
        }

        // Fetch movie video data
        async function fetchMovieVideos(movieId) {
            try {
                const response = await fetch(`${baseUrl}/movie/${movieId}/videos?api_key=${apiKey}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch movie videos');
                }
                const videoData = await response.json();
                const trailer = videoData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');
                if (trailer) {
                    displayMovieTrailer(trailer.key);
                }
            } catch (error) {
                console.error('Error fetching movie videos:', error);
            }
        }

        // Display movie details
        function displayMovieDetails(movie) {
            movieDetails.innerHTML = `
                <div class="movie-header" style="background-image: url('https://image.tmdb.org/t/p/original${movie.backdrop_path}'); background-size: cover; background-position: center;">
                    <h1>${movie.title}</h1>
                    <p><strong>Release Date:</strong> ${movie.release_date}</p>
                    <p><strong>Rating:</strong> ${movie.vote_average}</p>
                    <p><strong>Genres:</strong> ${movie.genres.map(genre => genre.name).join(', ')}</p>
                    <p class="overview"><strong>Overview:</strong> ${movie.overview}</p>
                </div>
                <div id="movie-trailer" class="movie-trailer"></div>
            `;
        }

        // Display the movie trailer
        function displayMovieTrailer(videoKey) {
            const movieTrailer = document.getElementById('movie-trailer');
            movieTrailer.innerHTML = `
                <iframe width="100%" height="500" src="https://www.youtube.com/embed/${videoKey}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            `;
        }

        // Get the movie ID from the URL and fetch details
        const movieId = getMovieId();
        if (movieId) {
            fetchMovieDetails(movieId);
        } else {
            movieDetails.innerHTML = '<p>Movie not found.</p>';
        }
    </script>
</body>
</html>
