<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - CineVerse</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="shortcut icon" href="./logo1.png" type="image/x-icon">
    <meta name="description" content="Details of the selected movie, including release date, rating, and overview.">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="logo" id="logo">
            <a href="./index.html">
                <img src="./logo1.png" alt="CineVerse Logo">
            </a>
        </div>
        <div>
            <h1 style="color: #ffA500;"><b><i>CineVerse</i></b></h1>
        </div>
        <nav class="nav-links">
            <a href="./index.html"><b>Home</b></a>
            <a href="./genre.html"><b>Genre</b></a>
            <a href="./search.html"><b>Search</b></a>
        </nav>
    </header>

    <main>
        <div id="loading" style="display: none;">Loading...</div>
        <div id="movie-details" class="movie-details">
            <!-- Movie details and video will be inserted here -->
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 CineVerse. All rights reserved.</p>
            <p>Contact us: info@CineVerse.com</p>
            <div class="social-media">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
        </div>
    </footer>
    
    <script>
        const apiKey = '06441985e67b0834a714e7433b1250ca';
        const baseUrl = 'https://api.themoviedb.org/3';
        const movieDetails = document.getElementById('movie-details');
        const loading = document.getElementById('loading');

        // Function to get the movie ID from the URL
        function getMovieId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('movieId');
        }

        // Fetch movie details
        async function fetchMovieDetails(movieId) {
            loading.style.display = 'block'; // Show loading
            try {
                const response = await fetch(`${baseUrl}/movie/${movieId}?api_key=${apiKey}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch movie details');
                }
                const movie = await response.json();
                displayMovieDetails(movie);
                displayMovieTrailer(movie); // Display the movie using the movie slug
            } catch (error) {
                movieDetails.innerHTML = '<p>Failed to load movie details. Please try again later.</p>';
                console.error('Error fetching movie details:', error);
            } finally {
                loading.style.display = 'none'; // Hide loading
            }
        }

        // Generate a slug from the movie title
        function generateSlug(title) {
            return title
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-') // Replace non-alphanumeric characters with hyphens
                .replace(/^-+|-+$/g, ''); // Trim leading and trailing hyphens
        }

        // Display movie details
        function displayMovieDetails(movie) {
            movieDetails.innerHTML = `
                <div class="movie-header">
                    <h1>${movie.title}</h1>
                    <p><strong>Release Date:</strong> <span>${movie.release_date}</span></p>
                    <p><strong>Rating:</strong> <span>${movie.vote_average}</span></p>
                    <p><strong>Genres:</strong> <span>${movie.genres.map(genre => genre.name).join(', ')}</span></p>
                    <p class="overview"><strong>Overview:</strong> <span>${movie.overview}</span></p>
                </div>
                <div class="posterimg">
                    <img src="https://image.tmdb.org/t/p/original${movie.poster_path}" alt="${movie.title} Poster" style="max-width: 100%; height: auto;">
                </div>
                <div id="movie-trailer" class="movie-trailer"></div>
            `;
        }

        // Display the embedded movie
        function displayMovieTrailer(movie) {
            const slug = generateSlug(movie.title);
            const movieTrailer = document.getElementById('movie-trailer');
            movieTrailer.innerHTML = `
                <iframe width="100%" height="500" src="https://flixhq.to/watch/${slug}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            `;
        }

        // Get the movie ID from the URL and fetch details
        const movieId = getMovieId();
        if (movieId) {
            fetchMovieDetails(movieId);
        } else {
            movieDetails.innerHTML = '<p>Movie not found.</p>';
        }
    </script>
</body>
</html>
